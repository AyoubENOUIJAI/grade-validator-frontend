<!DOCTYPE html>
<html>
<head>
    <title>Grade Validator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
            text-align: center;
        }
        .container {
            max-width: 600px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        select, input, button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        button {
            background-color: #007BFF;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Grade Validator</h2>
        <label for="year">Select Your Year:</label>
        <select id="year">
            <option value="CP">CP (1st & 2nd Year - Tronc Commun)</option>
            <option value="CGE3">CGE3 (3rd Year)</option>
            <option value="CGE4">CGE4 (4th Year)</option>
            <option value="CGE5">CGE5 (5th Year)</option>
        </select>
        
        <label for="semester">Select Semester:</label>
        <select id="semester">
            <option value="Semester 1">Semester 1</option>
            <option value="Semester 2">Semester 2</option>
        </select>
        
        <div id="specialization-section" style="display:none;">
            <label for="specialization">Select Specialization (CGE3 only):</label>
            <select id="specialization">
                <option value="Gestion">Gestion</option>
                <option value="Commerce">Commerce</option>
            </select>
        </div>
        
        <button onclick="getModules()">Next</button>
        
        <div id="modules-section" style="display:none;">
            <h3>Enter Your Grades</h3>
            <div id="modules"></div>
            <button onclick="submitGrades()">Validate</button>
        </div>
        
        <div id="result-section" style="display:none;">
            <h3>Validation Results</h3>
            <p id="result"></p>
        </div>
    </div>

    <script>
        function getModules() {
            let year = document.getElementById("year").value;
            let semester = document.getElementById("semester").value;
            let specialization = document.getElementById("specialization").value;
            
            if (year === "CGE3") {
                document.getElementById("specialization-section").style.display = "block";
                specialization = document.getElementById("specialization").value;
            } else {
                specialization = null;
            }

            fetch("https://grade-validator-backend.onrender.com/modules", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ year, semester, specialization })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                    return;
                }
                let modulesDiv = document.getElementById("modules");
                modulesDiv.innerHTML = "";
                data.modules.forEach(module => {
                    modulesDiv.innerHTML += `<label>${module}</label>
                        <input type='number' id='cc-${module}' placeholder='CC Grade (0-20)' min='0' max='20'>
                        <input type='number' id='exam-${module}' placeholder='Exam Grade (0-20)' min='0' max='20'>`;
                });
                document.getElementById("modules-section").style.display = "block";
            });
        }

        function submitGrades() {
            let year = document.getElementById("year").value;
            let semester = document.getElementById("semester").value;
            let specialization = document.getElementById("specialization").value;
            
            let modules = document.querySelectorAll("#modules label");
            let grades = {};
            modules.forEach(moduleLabel => {
                let moduleName = moduleLabel.innerText;
                let cc = document.getElementById(`cc-${moduleName}`).value;
                let exam = document.getElementById(`exam-${moduleName}`).value;
                grades[moduleName] = { cc: parseFloat(cc), exam: parseFloat(exam) };
            });

            fetch("https://grade-validator-backend.onrender.com/validate", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ year, semester, specialization, grades })
            })
            .then(response => response.json())
            .then(data => {
                let resultDiv = document.getElementById("result");
                resultDiv.innerHTML = `<p><strong>Validated Modules:</strong> ${data.validated_modules.join(", ")}</p>
                    <p><strong>Compensatable Modules:</strong> ${data.compensatable_modules.join(", ")}</p>
                    <p><strong>Failed Modules:</strong> ${data.failed_modules.join(", ")}</p>
                    <p><strong>Average:</strong> ${data.average.toFixed(2)}</p>
                    <p><strong>Semester Validated:</strong> ${data.semester_validated ? "Yes ✅" : "No ❌"}</p>
                    <p><strong>Honors:</strong> ${data.honors || "None"}</p>`;
                document.getElementById("result-section").style.display = "block";
            });
        }
    </script>
</body>
</html>
